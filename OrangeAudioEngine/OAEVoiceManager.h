#pragma once

//////////////////////////////////////////////////////////////////////////
/// Includes
//////////////////////////////////////////////////////////////////////////

#include <OrangeAudioEngineDefs.h>


//////////////////////////////////////////////////////////////////////////
/// Forward Declarations
//////////////////////////////////////////////////////////////////////////

class COAESourceManager;
class COAEVoice;


//////////////////////////////////////////////////////////////////////////
/// COAEVoiceManager
//////////////////////////////////////////////////////////////////////////

// manages all of the active voices in the engine
class COAEVoiceManager
{
public:
    
    //////////////////////////////////////////////////////////////////////////

    COAEVoiceManager( COAESourceManager* aSourceManager, IXAudio2* anXAudioInterface );
    ~COAEVoiceManager();

    //////////////////////////////////////////////////////////////////////////

    OAVoiceId   CreateVoice( const OASourceId& aSourceId );
    void        DestroyVoice( const OAVoiceId& aVoiceId );

    bool        Play( const OAVoiceId& aVoiceId );

    //////////////////////////////////////////////////////////////////////////

    void        Update( OAFloat32 aDeltaTime );


private:

    //////////////////////////////////////////////////////////////////////////

    typedef std::shared_ptr<COAEVoice>                  OAEVoicePtr;
    typedef std::unordered_map<OAVoiceId, OAEVoicePtr>  OAEVoiceMap;

    //////////////////////////////////////////////////////////////////////////

    COAESourceManager*  m_sourceManager;
    IXAudio2*           m_xaudio2Interface;

    OAEVoiceMap         m_voices;
    OAVoiceId           m_nextVoiceId;
};

//////////////////////////////////////////////////////////////////////////